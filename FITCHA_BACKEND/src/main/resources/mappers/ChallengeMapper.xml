<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssafy.fitcha.model.dao.ChallengeDao">
	<!-- 검색 목록 조회(전체 목록 조회) -->
	<select id="selectSearchChallengeBoardList" parameterType="SearchChallenge" resultType="challenge">
	SELECT *
	  FROM challenge_board
	WHERE 1 = 1
	<if test="key == 'title'">
	 AND title LIKE concat('%', #{word}, '%')
	</if>
	<if test="key == 'both'">
	 AND (title LIKE concat('%', #{word}, '%')
	      OR content LIKE concat('%', #{word}, '%'))
	</if>
	<if test="key == 'writer'">
	 AND writer LIKE concat('%', #{word}, '%')
	</if>

	<if test="exerciseType != null and exerciseType != ''">
	 AND exercise_type = #{exerciseType}
	</if>
	<if test="bodyPart != null and bodyPart != ''">
	 AND body_part = #{bodyPart}
	</if>
	<if test="level != null and level != ''">
	 AND level = #{level}
	</if>
	<if test="duration != null and duration != ''">
	 AND duration = #{duration}
	</if>
	<if test="participantCount != 0">
	 AND participant_count = #{participantCount}
	</if>
	
	
</select>
	
	<!-- 상세 조회 -->
	<select id="selectChallengeBoard" parameterType="int" resultType="challenge">
		SELECT *
		  FROM challenge_board
		 WHERE challenge_board_id = #{id}
	</select>
	
	<!-- 수정 -->
	<update id="updateChallengeBoard" parameterType="challenge">
		UPDATE challenge_board
		    SET title = #{title},
		    	content = #{content}, 
		    	exercise_type = #{exerciseType},
		    	body_part = #{bodyPart},
		   		level = #{level},
			    participant_count = #{participantCount}
		  WHERE challenge_board_id = #{challengeBoardId} 
	</update>
	
	<!-- 삭제  -->
	<delete id="deleteChallengeBoard" parameterType="int">
		DELETE FROM challenge_board
		      WHERE challenge_board_id =#{id}
	</delete>

	<!-- 등록 -->
	<insert id="insertChallengeBoard" parameterType="challenge" useGeneratedKeys="true" keyProperty="challengeBoardId">
		INSERT INTO challenge_board (user_id, title, content, writer, exercise_type, body_part, level, duration)
			 VALUES (#{userId},#{title},#{content},#{writer}, #{exerciseType},#{bodyPart},#{level},#{duration})
	</insert>
</mapper>